# [IMMICH-GO](https://github.com/simulot/immich-go)

Téléchargez vos photos sur votre serveur Immich :

``` bash
./immich-go -server=URL:PORT -key=XXXXXXXXXXXXXXXXXXXXXXXXXXXX upload -dry-run -create-albums -google-photos /mnt/storage/archives/takeout/allfab/takeout-*.zip

./immich-go -server=URL:PORT -key=XXXXXXXXXXXXXXXXXXXXXXXXXXXX upload -create-albums -google-photos /mnt/storage/archives/takeout/allfab/takeout-*.zip
```

## Shared options with all commands

| **Parameter**                            | **Description**                                                                                                                                                               | **Default value**                                                                                                                                                                                                      |
| ---------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `-use-configuration=path/to/config/file` | Specifies the configuration file to use. <br>Server URL and the API key are stored into the immich-go configuration file. They can be omitted for the next runs.              | Linux `$HOME/.config/immich-go/immich-go.json`<br>Windows `%AppData%\immich-go\immich-go.json`<br>Apple `$HOME/Library/Application Support/immich-go/immich-go.json`                                                   |
| `-server=URL`                            | URL of the Immich service, example http://<your-ip>:2283 or https://your-domain                                                                                               |                                                                                                                                                                                                                        |
| `-api=URL`                               | URL of the Immich api endpoint (http://container_ip:3301)                                                                                                                     |                                                                                                                                                                                                                        |
| `-device-uuid=VALUE`                     | Force the device identification                                                                                                                                               | `$HOSTNAME`                                                                                                                                                                                                            |
| `-client-timeout=duration`               | Set the timeout for server calls. The duration is a decimal number with a unit suffix, such as "300ms", "1.5m" or "45m". Valid time units are "ms", "s", "m", "h".            | `5m`                                                                                                                                                                                                                   |
| `-skip-verify-ssl`                       | Skip SSL verification for use with self-signed certificates                                                                                                                   | `false`                                                                                                                                                                                                                |
| `-key=KEY`                               | A key generated by the user. Uploaded photos will belong to the key's owner.                                                                                                  |                                                                                                                                                                                                                        |
| `-log-level=LEVEL`                       | Adjust the log verbosity as follows: <br> - `ERROR`: Display only errors  <br>  - `WARNING`: Same as previous one plus non-blocking error <br> - `INFO`: Information messages | `INFO`                                                                                                                                                                                                                 |
| `-log-file=/path/to/log/file`            | Write all messages to a file                                                                                                                                                  | Linux `$HOME/.cache/immich-go/immich-go_YYYY-MM-DD_HH-MI-SS.log` <br>Windows `%LocalAppData%\immich-go\immich-go_YYYY-MM-DD_HH-MI-SS.log` <br>Apple `$HOME/Library/Caches/immich-go/immich-go_YYYY-MM-DD_HH-MI-SS.log` |
| `-log-json`                              | Output the log as line-delimited JSON file                                                                                                                                    | `false`                                                                                                                                                                                                                |
| `-time-zone=time_zone_name`              | Set the time zone for dates without time zone information                                                                                                                     | the system's time zone                                                                                                                                                                                                 |
| `-no-ui`                                 | Disable the user interface                                                                                                                                                    | `false`                                                                                                                                                                                                                |
| `-debug-counters`                        | Enable the generation a CSV beside the log file                                                                                                                               | `false`                                                                                                                                                                                                                |
| `-api-trace`                             | Enable trace of API calls                                                                                                                                                     | `false`                                                                                                                                                                                                                |

## Command `upload`

Use this command for uploading photos and videos from a local directory, a zipped folder or all zip files that google photo takeout procedure has generated.

### Switches and options:

| **Parameter**                        | **Description**                                                                                    | **Default value**                                                                         |
| ------------------------------------ | -------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------- |
| `-album="ALBUM NAME"`                | Import assets into the Immich album `ALBUM NAME`.                                                  |                                                                                           |
| `-dry-run`                           | Preview all actions as they would be done.                                                         | `FALSE`                                                                                   |
| `-create-album-folder`               | Generate immich albums after folder names.                                                         | `FALSE`                                                                                   |
| `-create-stacks`                     | Stack jpg/raw or bursts.                                                                           | `FALSE`                                                                                   |
| `-stack-jpg-raw`                     | Control the stacking of jpg/raw photos.                                                            | `FALSE`                                                                                   |
| `-stack-burst`                       | Control the stacking bursts.                                                                       | `FALS`                                                                                    |
| `-select-types=".ext,.ext,.ext..."`  | List of accepted extensions.                                                                       |                                                                                           |
| `-exclude-types=".ext,.ext,.ext..."` | List of excluded extensions.                                                                       |                                                                                           |
| `-when-no-date=FILE\|NOW`            | When the date of take can't be determined, use the FILE's date or the current time NOW.            | `FILE`                                                                                    |
| `-exclude-files=pattern`             | Ignore files based on a pattern. Case insensitive. Repeat the option for each pattern do you need. | `@eaDir/`<br>`@__thumb/`<br>`SYNOFILE_THUMB_*.*`<br>`Lightroom Catalog/`<br>`thumbnails/` |

### Date selection:
Fine-tune import based on specific dates:

| **Parameter**      | **Description**                                |
| ------------------ | ---------------------------------------------- |
| `-date=YYYY-MM-DD` | import photos taken on a particular day.       |
| `-date=YYYY-MM`    | select photos taken during a particular month. |
| `-date=YYYY`       | select photos taken during a particular year.  |

### Exclude files based on a pattern

Use the `-exclude-files=PATTERN` to exclude certain files or directories from the upload. Repeat the option for each pattern do you need. The following directories are excluded automatically:
- @eaDir/
- @__thumb/
- SYNOFILE_THUMB_\*.\*
- Lightroom Catalog/
- thumbnails/
- .DS_Store/


Example, the following command excludes any files in directories called backup or draft and any file with name finishing with "copy)" as PXL_20231006_063121958 (another copy).jpg:
```sh
immich-go -sever=xxxxx -key=yyyyy upload -exclude-files=backup/ -exclude-files=draft/ -exclude=copy).*  /path/to/your/files
```

### Google photos options:
Specialized options for Google Photos management:

| **Parameter**                      | **Description**                                                                  | **Default value** |
| ---------------------------------- | -------------------------------------------------------------------------------- | ----------------- |
| `-google-photos`                   | import from a Google Photos structured archive, recreating corresponding albums. |                   |
| `-from-album="GP Album"`           | Create the album in `immich` and import album's assets.                          |                   |
| `-create-albums`                   | Controls creation of Google Photos albums in Immich.                             | `TRUE`            |
| `-keep-untitled-albums`            | Untitled albums are imported into `immich` with the name of the folder as title. | `FALSE`           |
| `-use-album-folder-as-name`        | Use the folder's name instead of the album title.                                | `FALSE`           |
| `-keep-partner`                    | Specifies inclusion or exclusion of partner-taken photos.                        | `TRUE`            |
| `-partner-album="partner's album"` | import assets from partner into given album.                                     |                   |
| `-discard-archived`                | don't import archived assets.                                                    | `FALSE`           |
| `-upload-when-missing-JSON`        | Upload photos not associated with a JSON metadata file                           | `FALSE`           |

Read [here](docs/google-takeout.md) to understand how Google Photos takeout isn't easy to handle.

### Burst detection
Currently the bursts following this schema are detected:
- xxxxx_BURSTnnn.*
- xxxxx_BURSTnnn_COVER.*
- xxxxx.RAW-01.COVER.jpg and xxxxx.RAW-02.ORIGINAL.dng
- xxxxx.RAW-01.MP.COVER.jpg and xxxxx.RAW-02.ORIGINAL.dng
- xxxxxIMG_xxxxx_BURSTyyyymmddhhmmss.jpg and xxxxxIMG_xxxxx_BURSTyyyymmddhhmmss_COVER.jpg (Huawei Nexus 6P)
- yyyymmdd_hhmmss_xxx.jpg (Samsung)

All images must be taken during the same minute.
The COVER image will be the parent image of the stack

### Couple jpg/raw detection
Both images should be taken in the same minute.
The JPG image will be the cover. 

Please open an issue to cover more possibilities.

### Example Usage: uploading a Google photos takeout archive

To illustrate, here's a command importing photos from a Google Photos takeout archive captured between June 1st and June 30th, 2019, while auto-generating albums:

```sh
./immich-go -server=http://mynas:2283 -key=zzV6k65KGLNB9mpGeri9n8Jk1VaNGHSCdoH1dY8jQ upload
-create-albums -google-photos -date=2019-06 ~/Download/takeout-*.zip             
```